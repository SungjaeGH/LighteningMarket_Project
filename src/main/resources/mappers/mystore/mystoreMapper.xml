<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.project.lighteningmarket.mappers.mystore.mystoreMapper">

    <!--    상품페이지 -->
    <select id="product_listAll"  resultMap="ProductResultMap">
        <![CDATA[
        SELECT DISTINCT proIdx,
                        title,
                        price,
                        regDate,
                        tradeArea
        FROM tbl_product
--                  INNER JOIN tbl_images ON tbl_product.proIdx = tbl_images.proIdx
        WHERE tbl_product.id = 'gold01130';
        ]]>
    </select>


    <!--        찜페이지-->
    <select id="favorites_listAll" resultMap="ProductResultMap">
        <![CDATA[
        SELECT DISTINCT proIdx,
                        title,
                        price,
                        regDate,
                        tradeArea
        FROM tbl_product
                 INNER JOIN tbl_favorites ON tbl_product.proIdx = tbl_favorites.pro_idx
        WHERE tbl_favorites.id = 'gold01130';
        ]]>
    </select>


    <!--        상점문의 페이지-->
    <select id="storeQa_listAll" resultMap="StoreQaResultMap">
        <![CDATA[
        SELECT DISTINCT store_qa_idx
                      , tbl_store_qa.nickname
                      , store_qa_des
                      , unknown_check
        FROM tbl_store_qa
                 INNER JOIN tbl_member ON tbl_store_qa.nickname = tbl_member.nickname
        WHERE tbl_member.nickname = 'sdfqwe';
        ]]>
    </select>

    <!--    상점문의 테이블에 추가하기-->
    <insert id="storeQa_create">
        INSERT INTO tbl_store_qa (
                                    nickname
                                 , store_qa_des
                                 , unknown_check
        ) VALUES (
                   'sdfqwe'
                 , #{storeQaDes}
                 , #{unknownCheck}
                 )
    </insert>

<!--    상점문의 테이블에 삭제하기-->
    <delete id="storeQa_delete">
        DELETE FROM tbl_store_qa
        WHERE store_qa_idx = #{storeQaIdx}
    </delete>


    <!--     팔로워 페이지 (팔로워한 유저들 불러오기)-->
    <select id="follower_listAll" parameterType="com.project.lighteningmarket.mystore.domain.FollowerVO" resultMap="FollowerNicknameResultMap">
        <![CDATA[
        select DISTINCT nickname
        from tbl_member
                 INNER JOIN tbl_follower ON tbl_member.id = tbl_follower.from_user
        WHERE tbl_follower.to_user = #{loginId};
        ]]>
    </select>

<!--    팔로워 페이지 (상품수) -->
    <select id="follower_productCount" parameterType="int" resultMap="int">
        <![CDATA[
        select count(*) AS productCount
        from tbl_product inner join tbl_member
        where tbl_member.nickname = #{followerNickname};
        ]]>
    </select>

<!--
    &lt;!&ndash;     팔로워 페이지 (팔로워 수)&ndash;&gt;
    <select id="follower_listAll" resultMap="FollowerCountResultMap">
        <![CDATA[
        select count(*) from tbl_follower
        where tbl_follower.to_user = #{followerNickname};
        ]]>
    </select>
-->

    <!-- 쿠키를 이용해서 ID 찾기 -->
    <select id="searchId" parameterType="string" resultType="string">
        SELECT id
        FROM bunjang.tbl_member
        where session_key = #{loginId};
    </select>

    <resultMap id="ProductResultMap" type="ProductVO">
        <id property="proIdx" column="proIdx"/>
        <result property="id" column="id"/>
        <result property="title" column="title"/>
        <result property="tradeArea" column="tradeArea"/>
        <result property="statement" column="statement"/>
        <result property="exchange" column="exchange"/>
        <result property="price" column="price"/>
        <result property="description" column="description"/>
        <result property="count" column="count"/>
        <result property="regDate" column="regDate"/>
    </resultMap>

    <resultMap id="StoreQaResultMap" type="StoreQaVO">
        <id property="storeQaIdx" column="store_qa_idx"/>
        <result property="nickname" column="nickname"/>
        <result property="storeQaDes" column="store_qa_des"/>
        <result property="unknownCheck" column="unknown_check"/>
    </resultMap>

    <resultMap id="FollowerNicknameResultMap" type="FollowerVO">
        <result property="followerNickname" column="nickname"/>
    </resultMap>

    <resultMap id="FollowerProductCountResultMap" type="FollowerVO">
        <result property="followerProdutCount" column="productCount"/>
    </resultMap>

</mapper>